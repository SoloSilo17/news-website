<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Portal de noticias en español con las últimas actualizaciones nacionales e internacionales">
    <meta name="keywords" content="noticias, deportes, cultura, internacional">
    <meta name="author" content="Noticias en Español">
    <title>Noticias en Español</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Noticias en Español</h1>
        <p>El portal para las últimas noticias del mundo hispanohablante.</p>
    </header>

    <nav>
        <a href="#inicio" id="inicio-link">Inicio</a>
        <a href="#nacional" id="nacional-link">Nacional</a>
        <a href="#internacional" id="internacional-link">Internacional</a>
        <a href="#deportes" id="deportes-link">Deportes</a>
        <a href="#immigracion" id="immigracion-link">Immigracion</a>
    </nav>

    <main>
        <section id="inicio" class="section">
            <h2>Inicio</h2>
            <div id="inicio-articles"></div>
        </section>

        <section id="nacional" class="section" style="display: none;">
            <h2>Nacional</h2>
            <div id="nacional-articles"></div>
        </section>

        <section id="internacional" class="section" style="display: none;">
            <h2>Internacional</h2>
            <div id="internacional-articles"></div>
        </section>

        <section id="deportes" class="section" style="display: none;">
            <h2>Deportes</h2>
            <div id="deportes-articles"></div>
        </section>

        <section id="immigracion" class="section" style="display: none;">
            <h2>Immigracion</h2>
            <div id="immigracion-articles"></div>
        </section>
        
        <section id="full-article-view" class="full-article" style="display: none;"></section>
    </main>

    <footer>
        <p>&copy; 2025 Noticias en Español. Todos los derechos reservados.</p>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const sections = document.querySelectorAll(".section");
            const fullArticleView = document.getElementById("full-article-view");
            let lastSection = "inicio";

            const fetchArticlesByCategory = async (category, containerId) => {
                try {
                    const response = await fetch(`/api/articles/${category}`);
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }

                    const articles = await response.json();
                    const container = document.getElementById(containerId);

                    if (!container) {
                        console.error(`Error: Container with ID "${containerId}" not found.`);
                        return;
                    }

                    container.innerHTML = ""; // Clear existing content
                    articles.forEach((article) => {
                        const articleElement = document.createElement("article");
                        articleElement.classList.add("article");
                        articleElement.innerHTML = `
                            <h3>${article.title}</h3>
                            <p><strong>Resumen:</strong> ${article.summary}</p>
                            <p>${article.content}</p>
                            <img src="${article.image_url}" alt="${article.title}">
                        `;
                        container.appendChild(articleElement);
                    });
                } catch (error) {
                    console.error("Error fetching articles:", error);
                    const container = document.getElementById(containerId);
                    if (container) {
                        container.innerHTML = `<p>Error loading articles. Please try again later.</p>`;
                    }
                }
            };

            const showSection = (sectionId) => {
                // Hide all sections and display the selected one
                sections.forEach((section) => {
                    section.style.display = section.id === sectionId ? "block" : "none";
                });

                // Update the hash in the URL dynamically
                window.location.hash = `#${sectionId}`;

                // Fetch articles for the current section
                fetchArticlesByCategory(sectionId, `${sectionId}-articles`);

                // Save the last section in localStorage
                lastSection = sectionId;
                localStorage.setItem("lastVisitedSection", sectionId);
            };

            // Restore last section or default to "inicio" on page load
            const hash = window.location.hash.replace("#", ""); // Extract hash without '#'
            const savedSection = hash || localStorage.getItem("lastVisitedSection") || "inicio";
            showSection(savedSection);

            // Add event listeners for navigation
            document.querySelectorAll("nav a").forEach((link) => {
                link.addEventListener("click", (e) => {
                    e.preventDefault();
                    const targetSection = e.target.getAttribute("href").replace("#", "");
                    showSection(targetSection);
                });
            });
        });
    </script>
</body>
</html>
