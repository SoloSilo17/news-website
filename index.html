<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Portal de noticias en español con las últimas actualizaciones nacionales e internacionales">
    <meta name="keywords" content="noticias, deportes, cultura, internacional">
    <meta name="author" content="Noticias en Español">
    <title>Noticias en Español</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Noticias en Español</h1>
        <p>El portal para las últimas noticias del mundo hispanohablante.</p>
    </header>

    <nav>
        <a href="#inicio" id="inicio-link">Inicio</a>
        <a href="#nacional" id="nacional-link">Nacional</a>
        <a href="#internacional" id="internacional-link">Internacional</a>
        <a href="#deportes" id="deportes-link">Deportes</a>
        <a href="#immigracion" id="immigracion-link">Immigracion</a>
    </nav>

    <main>
        <section id="inicio" class="section">
            <h2 class="section-title">Inicio</h2>
            <div id="inicio-articles"></div>
        </section>

        <section id="nacional" class="section" style="display: none;">
            <h2 class="section-title">Nacional</h2>
            <div id="nacional-articles"></div>
        </section>

        <section id="internacional" class="section" style="display: none;">
            <h2 class="section-title">Internacional</h2>
            <div id="internacional-articles"></div>
        </section>

        <section id="deportes" class="section" style="display: none;">
            <h2 class="section-title">Deportes</h2>
            <div id="deportes-articles"></div>
        </section>

        <section id="immigracion" class="section" style="display: none;">
            <h2 class="section-title">Immigracion</h2>
            <div id="immigracion-articles"></div>
        </section>
        
        <section id="full-article-view" class="full-article" style="display: none;"></section>
    </main>

    <footer>
        <p>&copy; 2025 Noticias en Español. Todos los derechos reservados.</p>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const sections = document.querySelectorAll(".section");
            const fullArticleView = document.getElementById("full-article-view");
            let lastSection = "inicio";

            const fetchArticlesByCategory = async (category, containerId) => {
                try {
                    const response = await fetch(`/api/articles/${category}`);
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }

                    const articles = await response.json();
                    const container = document.getElementById(containerId);

                    if (!container) {
                        console.error(`Error: Container with ID "${containerId}" not found.`);
                        return;
                    }

                    container.innerHTML = ""; // Clear existing content
                    articles.forEach((article) => {
                        const articleElement = document.createElement("article");
                        articleElement.classList.add("article");
                        articleElement.innerHTML = `
                            <div class="article-content">
                                <h3>${article.title}</h3>
                                <p><strong>Resumen:</strong> ${article.summary}</p>
                                <p>${article.content}</p>
                            </div>
                            <img src="${article.image_url}" alt="${article.title}">
                        `;
                        articleElement.addEventListener("click", () => {
                            viewFullArticle(article);
                        });
                        container.appendChild(articleElement);
                    });
                } catch (error) {
                    console.error("Error fetching articles:", error);
                    const container = document.getElementById(containerId);
                    if (container) {
                        container.innerHTML = `<p>Error loading articles. Please try again later.</p>`;
                    }
                }
            };

            const showSection = (sectionId) => {
                sections.forEach((section) => {
                    section.style.display = section.id === sectionId ? "block" : "none";
                });

                window.location.hash = `#${sectionId}`;

                fetchArticlesByCategory(sectionId, `${sectionId}-articles`);

                lastSection = sectionId;
                localStorage.setItem("lastVisitedSection", sectionId);
            };

            const viewFullArticle = (article) => {
                fullArticleView.innerHTML = `
                    <a href="#${lastSection}" class="back-button">&larr; Volver</a>
                    <div class="full-article-content">
                        <h2>${article.title}</h2>
                        <img src="${article.image_url}" alt="${article.title}">
                        <p><strong>Resumen:</strong> ${article.summary}</p>
                        <p>${article.content}</p>
                    </div>
                `;
                fullArticleView.style.display = "block";
                sections.forEach((section) => section.style.display = "none");

                const backButton = fullArticleView.querySelector(".back-button");
                backButton.addEventListener("click", () => {
                    window.location.href = `#${lastSection}`;
                    window.location.reload();
                });
            };

            const hash = window.location.hash.replace("#", "");
            const savedSection = hash || localStorage.getItem("lastVisitedSection") || "inicio";
            showSection(savedSection);

            document.querySelectorAll("nav a").forEach((link) => {
                link.addEventListener("click", (e) => {
                    e.preventDefault();
                    const targetSection = e.target.getAttribute("href").replace("#", "");
                    showSection(targetSection);
                });
            });
        });
    </script>
</body>
</html>
